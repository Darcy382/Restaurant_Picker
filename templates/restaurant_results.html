{% extends "restaurant_search.html" %}

{% block map %}
    <div class="map">
        <div class="map-sticky">
            <h2>Locations</h2>
            <div id="map"></div>
        </div>
        <script>
            window.map = undefined;
            var markers = [];
            function initMap() {
                // Map options
                var options = {
                    zoom: 14,
                    center: {lat: {{ location['lat'] }}, lng: {{ location['long'] }}},
                };

                // New map
                window.map = new google.maps.Map(document.getElementById('map'), options);

                // Add marker
                setMarker(map);
            }

            var locations = {{ biz_locations|safe }};
            function setMarker(map) {
                for (var i = 0; i < locations.length; i++) {
                    var restaurant = locations[i];
                    var marker = new google.maps.Marker({
                        position: {lat: restaurant[1], lng: restaurant[2]},
                        map: map,
                        title: restaurant[0],
                        label: (i + 1).toString(),
                    });
                    markers.push(marker)
                }
            }

            function imageHover(coordinates, markerNum) {
                var center = new google.maps.LatLng(coordinates['latitude'], coordinates['longitude']);
                var map = document.getElementById("map");
                window.map.panTo(center);

                /*Function to change the marker logo when hover over it
                markers[markerNum].setIcon({
                    url:'{{ url_for("static", filename="images/marker.png") }}',
                    scaledSize: new google.maps.Size(64, 64),
                });
               // markers[markerNum].setZIndex(1);*/
            }
        </script>  <!-- Google Maps JS API -->
        <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBdwB7GxC3-58cYNXpWQ-A5WuA0L5Jj1qU&callback=initMap">
        </script>
    </div>
{%  endblock %}

{% block search_results %}
    <script>
        document.getElementById('search_value').value = "{{ search_value|safe }}";
    </script>
    <div class="results">
        {% if no_results == False %}
            <h2>Restaurants near you:</h2>
            {% for biz in results["businesses"] %}
                <a href={{ biz["url"]}}>
                <div onmouseover="JavaScript:imageHover({{ biz["coordinates"]|safe }}, {{ loop.index }})"
                     class="block">  <!-- Centers the maps on the bussiness that is being hovered over -->
                    <h3><b>{{ loop.index }}) {{ biz["name"] }}</b></h3>
                    <img src={{ biz["image_url"] }}>  <!-- Image -->
                    <p>({{ biz['phone'][2:5] }}) {{ biz['phone'][5:8] }}-{{ biz['phone'][8:] }}</p>  <!-- Phone # -->
                    <div id="rating-stars">
                        {% set rating = biz['rating'] %}
                        {% if rating == 5 %}
                            <img src={{ url_for("static", filename="images/yelp_stars/regular_5@3x.png") }}>
                        {% elif rating == 4.5 %}
                            <img src={{ url_for("static", filename="images/yelp_stars/regular_4_half@3x.png") }}>
                         {% elif rating == 4 %}
                            <img src={{ url_for("static", filename="images/yelp_stars/regular_4@3x.png") }}>
                        {% elif rating == 3.5 %}
                            <img src={{ url_for("static", filename="images/yelp_stars/regular_3_half@3x.png") }}>
                        {% elif rating == 3 %}
                            <img src={{ url_for("static", filename="images/yelp_stars/regular_3@3x.png") }}>
                        {% elif rating == 2.5 %}
                            <img src={{ url_for("static", filename="images/yelp_stars/regular_2_half@3x.png") }}>
                        {% elif rating == 2 %}
                            <img src={{ url_for("static", filename="images/yelp_stars/regular_2@3x.png") }}>
                        {% elif rating == 1.5 %}
                            <img src={{ url_for("static", filename="images/yelp_stars/regular_1_half@3x.png") }}>
                        {% elif rating == 1 %}
                            <img src={{ url_for("static", filename="images/yelp_stars/regular_1@3x.png") }}>
                        {% else %}
                            <img src={{ url_for("static", filename="images/yelp_stars/regular_0@3x.png") }}>
                        {% endif %}
                    </div> <!-- Rating stars -->
                    <p id="category">{{ biz['categories'][0]['title'] }}</p>
                    <img id="yelp-logo" src={{ url_for("static", filename="images/yelp_logo.png") }}>
                </div>
                </a>
            {% endfor %}
        {% else %}
            <h2>Sorry! We have no results for this search</h2>
        {% endif %}
    </div>
{% endblock %}